<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-88">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A basic web application to store records of favourite novels">
    <meta name="author" content="Emmanuel Enchill">

    <title>ASHNovel Catalogue | New Record</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Tempus Dominus Datepicker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.7.7/dist/css/tempus-dominus.min.css">

    <style>
        .novel-form-container {
            min-width: 70%;
        }
        .form-section {
            border: 1px solid rgba(0,0,0,.125);
            border-radius: 0.375rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .form-section legend {
            width: auto;
            padding: 0 0.5rem;
            font-size: 1.1rem;
            font-weight: 500;
        }
        .btn-action {
            min-width: 120px;
        }
    </style>
</head>
<body class="bg-light">
<section class="container">
    <div>
        <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
            <a class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
                <span class="fs-4">ASHNovel Catalogue</span>
            </a>

            <ul class="nav nav-pills">
                <li class="nav-item"><a th:href="@{/catalogue/home}" class="nav-link active">Home</a></li>
                <li class="nav-item"><a th:href="@{/catalogue/new_novel}" class="nav-link">Add Novel</a></li>
            </ul>
        </header>
    </div>
    <div class="container-fluid-md d-flex justify-content-center align-items-center min-vh-100">
        <div class="novel-form-container bg-white p-4 shadow rounded-3">
            <h2 class="text-center mb-4"><i class="bi bi-book me-2"></i>Register New Novel</h2>

            <form method="post" th:action="@{/catalogue/new_novel}" th:object="${novel}" id="novelForm" class="needs-validation" novalidate>
                <fieldset class="form-section">
                    <legend>Novel Information</legend>

                    <!-- Title -->
                    <div class="mb-3">
                        <label for="novelTitle" class="form-label">Title <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="novelTitle" th:field="*{title}" required>
                        <div class="invalid-feedback">Please provide a title.</div>
                    </div>

                    <!-- Author -->
                    <div class="mb-3">
                        <label for="novelAuthor" class="form-label">Author <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="novelAuthor" th:field="*{author}" required>
                        <div class="invalid-feedback">Please provide the author's name.</div>
                    </div>

                    <!-- Genre -->
                    <div class="mb-3">
                        <label for="novelGenre" class="form-label">Genre <span class="text-danger">*</span></label>
                        <select class="form-select" id="novelGenre" th:field="*{genre}" required>
                            <option value="" selected disabled>Select a genre</option>
                            <option value="Fiction">Fiction</option>
                            <option value="Mystery">Mystery</option>
                            <option value="Science Fiction">Science Fiction</option>
                            <option value="Fantasy">Fantasy</option>
                            <option value="Romance">Romance</option>
                            <option value="Thriller">Thriller</option>
                            <option value="Historical">Historical</option>
                            <option value="Horror">Horror</option>
                            <option value="Other">Other</option>
                        </select>
                        <div class="invalid-feedback">Please select a genre.</div>
                    </div>

                    <!-- ISBN -->
                    <div class="mb-3">
                        <label for="novelISBN" class="form-label">ISBN</label>
                        <input type="text" class="form-control" id="novelISBN" pattern="^(?:\d{3}-)?\d{10}$" placeholder="e.g., 123-4567890123 or 1234567890" th:field="*{isbn}" required>
                        <div class="invalid-feedback">Please enter a valid ISBN (10 digits with optional hyphens).</div>
                    </div>

                    <!-- Publication Year -->
                    <div class="mb-3">
                        <label for="novelPubDate" class="form-label">Publication Year <span class="text-danger">*</span></label>
                        <div class="input-group" id="datepicker">
                            <input type="text" class="form-control" id="novelPubDate" data-td-target="#datepicker" th:field="*{pubYear}" required>
                            <span class="input-group-text" data-td-target="#datepicker" data-td-toggle="datetimepicker">
                                <i class="bi bi-calendar"></i>
                            </span>
                        </div>
                        <div class="invalid-feedback">Please select a publication year.</div>
                    </div>

                    <!-- Publishing Company -->
                    <div class="mb-3">
                        <label for="novelPublisher" class="form-label">Publishing Company</label>
                        <input type="text" class="form-control" id="novelPublisher" th:field="*{pubCompany}" required>
                    </div>

                    <!-- Summary -->
                    <div class="mb-3">
                        <label for="novelSummary" class="form-label">Summary <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="novelSummary" rows="5" th:field="*{summary}" required></textarea>
                        <div class="invalid-feedback">Please provide a summary.</div>
                    </div>

                    <!-- Cover image -->
                    <div class="mb-3">
                        <label for="novelCover" class="form-label">Cover image <span class="text-danger">*</span></label>
                        <input class="form-control" type="file" id="novelCover" th:field="*{imagePath}" accept="image/*" required>
                        <div class="invalid-feedback">Please provide a summary.</div>
                    </div>
                </fieldset>

                <!-- Buttons -->
                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-outline-secondary btn-action" id="cancelBtn">
                        <i class="bi bi-x-circle me-1"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-primary btn-action">
                        <i class="bi bi-save me-1"></i> Save
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- JavaScript Libraries -->
<!-- Popper.js (required for Bootstrap) -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
<!-- Tempus Dominus Datepicker -->
<script src="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.7.7/dist/js/tempus-dominus.min.js"></script>

<script>
    // Initialize datepicker (year only)
    document.addEventListener('DOMContentLoaded', function() {
        const datepicker = new tempusDominus.TempusDominus(document.getElementById('datepicker'), {
            display: {
                components: {
                    decades: true,
                    year: true,
                    month: false,
                    day: false,
                    hour: false,
                    minute: false,
                    second: false
                },
                viewMode: 'years'
            },
            localization: {
                format: 'yyyy'
            }
        });

        // Form validation
        const form = document.getElementById('novelForm');
        const cancelBtn = document.getElementById('cancelBtn');

        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }

            form.classList.add('was-validated');
        }, false);

        cancelBtn.addEventListener('click', function() {
            if(confirm('Are you sure you want to cancel? All changes will be lost.')) {
                form.reset();
                form.classList.remove('was-validated');
            }
        });
    });
</script>

</body>
</html>